/*
 Smarty templater

 @author Artem Shalaev <artem.shalaev@gmail.com>, Sep 27, 2011 1:51:28 PM
 @copyright MegaGroup ? 2011, megagroup.ru
 @access public
 @package Smarty.js
 @version 1.0.1

 [~] - switched off, [-] - removed, [+] - added, [*] - modified 

 [~] Literal support 

 Supports: if, else, elseif, foreach, foreachelse, break, continue, while, capture, include

 @todo Parser exceptions with position
 @todo Parser support for screened quotes
 @todo Parsing expression into indexed array
 @todo Custom user functions
*/
(function(l){if(void 0===a){Function.prototype.bind||(Function.prototype.bind=function(c){if("function"!==typeof this)throw new TypeError("Function.prototype.bind - what is trying to be fBound is not callable");var a=Array.prototype.slice.call(arguments,1),d=this,b=function(){},g=function(){return d.apply(this instanceof b?this:c||l,a.concat(Array.prototype.slice.call(arguments)))};b.prototype=this.prototype;g.prototype=new b;return g});Array.prototype.forEach||(Array.prototype.forEach=function(c,
a){var d,b;if(null==this)throw new TypeError(" this is null or not defined");var g=Object(this),i=g.length>>>0;if("[object Function]"!={}.toString.call(c))throw new TypeError(c+" is not a function");a&&(d=a);for(b=0;b<i;){var h;b in g&&(h=g[Pk],c.call(d,h,b,g));b++}});String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var a=l.smarty={entities:{},modifiers:{},settings:{isDebug:!1,includeHandler:function(){throw new a.Exception("Method isn't implemented yet!");
},includeTimeout:3E3},configure:function(c){this.settings=a.utils.extend(this.settings,c||{});return this},addModifier:function(c,a){if(!this.utils.isFunction(a))throw new this.Exception("Parameter 'modifier' must be callable!");this.modifiers[c]=a;return this},addFunction:function(c,a){this.addEntity(c,{start:a});return this},addOperator:function(c,a,d){this.addEntity(c,{start:a,end:d});return this},addEntity:function(c,f){f=this.utils.extend({attributes:{_required:[]},start:function(){return""},
end:void 0,after:[],depends:[]},f||{});if(!this.utils.isFunction(f.start))throw new this.Exception("Callback [options.start] must be callable!");if(!this.utils.isUndefined(f.end)&&!this.utils.isFunction(f.end))throw new this.Exception("Callback [options.end] must be callable or [undefined]!");if(!this.utils.isArray(f.after)||!this.utils.isArray(f.depends))throw new this.Exception("[options.after] and [options.depends] must be an [Array]!");if(!this.utils.isObject(f.attributes))throw new this.Exception("[options.attributes] must be an [Object]!");
if(!a.utils.isArray(f.attributes._required))throw new a.Exception("[options.attributes._required] must be an [Array]!");f.attributes._required.forEach(function(c){if(!(c in f.attributes))throw new a.Exception("'{0}' is defined in require list, but isn't defined in attributes list!",c);});this.entities[c]=f;return this}};a.utils={types:{},format:function(c){var a=c;Array.prototype.slice.call(arguments,1).forEach(function(c,b){a=a.replace(RegExp("\\{"+b+"}","g"),c)});return a},extend:function(c){Array.prototype.slice.call(arguments,
1).forEach(function(a){for(var b in a)void 0!==a[b]&&(c[b]=a[b])});return c},inherit:function(c,f,b){var e,g=function(){};e=f&&f.hasOwnProperty("constructor")?f.constructor:function(){return c.apply(this,arguments)};a.utils.extend(e,c);g.prototype=c.prototype;e.prototype=new g;f&&a.utils.extend(e.prototype,f);b&&a.utils.extend(e,b);e.prototype.constructor=e;e.__super__=c.prototype;return e},getType:function(c){return null==c?""+c:this.types[Object.prototype.toString.call(c)]||"object"},isFunction:function(c){return"function"===
this.getType(c)},isUndefined:function(c){return void 0===c},isObject:function(c){return"object"===this.getType(c)},isString:function(c){return"string"===this.getType(c)},isArray:function(c){return"array"===this.getType(c)},count:function(c){if(this.isUndefined(c)||null===c)return 0;if(this.isArray(c))return c.length;if(this.isObject(c)){var a=0,b;for(b in c)c.hasOwnProperty(b)&&a++;return a}return 1}};a.debug={_isGroup:!1,_canDebug:function(){return a.settings.isDebug&&l.console},_formatMessage:function(c){var f=
new Date,b=f.getHours(),e=f.getMinutes(),g=f.getSeconds(),f=f.getMilliseconds();return a.utils.format("[DEBUG] {0}:{1}:{2}.{3}\t{4}",b,e,g,f,c)},log:function(){var c=a.utils.format.apply(a.utils,arguments);return this._canDebug()&&console.log(this._isGroup?c:this._formatMessage(c)),this},group:function(c,a){var b=this._formatMessage(c);this._isGroup=!0;return this._canDebug()&&(a?console.groupCollapsed(b):console.group(b)),this},groupEnd:function(){this._isGroup=!1;return this._canDebug()&&console.groupEnd(),
this}};a.Exception=a.utils.inherit(Error,a.Exception={constructor:function(){this.name="Smarty.Exception";this.message=a.utils.format.apply(a.utils,Array.prototype.slice.call(arguments))}});a.CompileException=a.utils.inherit(a.Exception,a.CompileException={constructor:function(c){if(!(c instanceof a.Compiler))throw new a.Exception("[compiler] must be instance of [smarty.Compiler]!");this.name="Smarty.CompileException";this.message=a.utils.format("[{0}:{1}] {2}",c.getTemplate().getName(),c.getLine(),
a.utils.format.apply(a.utils,Array.prototype.slice.call(arguments,1)))}});a.RuntimeException=a.utils.inherit(a.Exception,a.RuntimeException={constructor:function(){this.name="Smarty.RuntimeException";this.message=a.utils.format.apply(a.utils,Array.prototype.slice.call(arguments))}});var b={bind:function(c,a,b){var e=this._callbacks||(this._callbacks={});(e[c]||(e[c]=[])).push([a,b]);return this},unbind:function(c,a){var b;if(c){if(b=this._callbacks)if(a){b=b[c];if(!b)return this;for(var e=0,g=b.length;e<
g;e++)if(b[e]&&a===b[e][0]){b[e]=null;break}}else b[c]=[]}else this._callbacks={};return this},trigger:function(c){var a,b,e,g,i=2;if(!(b=this._callbacks))return this;for(;i--;)if(a=i?c:"all",a=b[a])for(var h=0,j=a.length;h<j;h++)(e=a[h])?(g=i?Array.prototype.slice.call(arguments,1):arguments,e[0].apply(e[1]||this,g)):(a.splice(h,1),h--,j--);return this}};a.Template=function(c){if(a.utils.isUndefined(c)||null===c||""==(""+c).trim())throw new a.Exception("Invalid template name '{0}'!",c);if(!(this instanceof
a.Template))return a.Template.factory.apply(a.Template,arguments);if(a.Template.isExists(c))throw new a.Exception("Template with name '{0}' already exists!",c);this._name=c;this._source="";this._closure=null;this._includes=[];this._loadedIncludes=[];this._includesMap={};return a.Template.set(this)};a.Template.prototype={constructor:a.Template,_loadHandler:function(a){a in this._includesMap&&(this._loadedIncludes.push(a),delete this._includesMap[a],this.isReady()&&b.trigger("load:"+this._name,this._name).unbind("load:"+
this._name))},_dispatch:function(){var c=[],f={};this._includes.forEach(function(d){d in f||(f[d]=!0,a.Template.isExists(d)?this._loadedIncludes.push(d):(c.push(d),this._includesMap[d]=!0,b.bind("load:"+d,function(a){this._loadHandler(a)}.bind(this))))}.bind(this));c.length?this._triggerIncludesHandler(c):b.trigger("load:"+this._name,this._name).unbind("load:"+this._name)},_triggerIncludesHandler:function(c){if(!a.utils.isFunction(a.settings.includeHandler))throw new a.Exception("[smarty.settings.includeHandler] must be callable!");
c.length&&a.settings.includeHandler(c)},exec:function(c,f){if(!a.utils.isFunction(f))throw new a.Exception("Parameter 'callback' must be callable!");var d=function(){f(this._closure.call(c instanceof a.Sandbox?c:new a.Sandbox(c)))}.bind(this);!this.isReady()||!this.isCompiled()?(b.bind("load:"+this._name,d),this.isCompiled()||this._triggerIncludesHandler([this._name])):d()},execSync:function(c){if(!this.isReady()||!this.isCompiled())throw new a.Exception("Template isn't ready for execution!");return this._closure.call(c instanceof
a.Sandbox?c:new a.Sandbox(c))},remove:function(){a.Template.remove(this._name)},isCompiled:function(){return null!==this._closure},isReady:function(){return this.isCompiled()&&this._includes.length===this._loadedIncludes.length},compile:function(c){if(!c)throw new a.Exception("Empty [source] parameter!");this._source=c;a.Compiler(this);return this},load:function(c,b){if(!a.utils.isFunction(c))throw new a.Exception("Parameter 'closure' must be callable!");this._closure=c;this._includes=b||[];this._dispatch();
return this},getIncludes:function(){return this._includes},getClosure:function(){return this._closure},getName:function(){return this._name},getSource:function(){return this._source}};a.Template.templates=[];a.Template.isExists=function(a){return this.templates.hasOwnProperty(a)};a.Template.get=function(c){if(!this.isExists(c))throw new a.Exception("Template with name '{0}' doesn't exist!",c);return this.templates[c]};a.Template.set=function(c){if(!(c instanceof this))throw new a.Exception("Only instances of [smarty.Template] can be added!");
return this.templates[c.getName()]=c};a.Template.remove=function(c){if(!this.isExists(c))throw new a.Exception("Template with name '{0}' doesn't exist!",c);delete this.templates[c]};a.Template.factory=function(c,b,d){b=b||null;c=a.Template.isExists(c)?a.Template.get(c):new a.Template(c);a.utils.isString(b)?c.compile(b):a.utils.isFunction(b)&&c.load(b,a.utils.isArray(d)?d:[]);return c};a.Sandbox=function(a){this._data=a;this._rootNamespace="root";this._namespaces=[this._rootNamespace];this._localVars=
{};this._localVars[this._rootNamespace]=this._data};a.Sandbox.prototype={constructor:a.Sandbox,gv:function(c){var b=c.keys||[],d=b.length;if(!d)throw new a.Exception("Invalid variable data!");for(var e=0,g=b[e++],c=c.modifiers||{},i="",h=function(c){if(e<d&&c.hasOwnProperty){var g=b[e++];a.utils.isObject(g)&&(g=this.gv(g));return""===g||a.utils.isUndefined(c=c[g])||null===c?"":h(c)}return c}.bind(this),j,k=this._namespaces.length;0<k--;)if(j=this._namespaces[k],this._localVars[j]&&this._localVars[j].hasOwnProperty(g)){i=
h(this._localVars[j][g]);break}if(null!==c)for(var m in c)m in a.modifiers&&(i=a.modifiers[m].apply(this,[i].concat(c[m])));return i},sv:function(a,b){this._localVars[this._namespaces[this._namespaces.length-1]][a]=b;return this},sn:function(c){if(0<=this._namespaces.indexOf(c))throw new a.Exception("Namespace '{0}' already exists!",c);this._namespaces.push(c);this._localVars[c]={};return this},en:function(a){if(!a||0>this._namespaces.indexOf(a))a=this._namespaces[this._namespaces.length-1];if(a!==
this._rootNamespace)for(;0<this._namespaces.length;){var b=this._namespaces.pop();delete this._localVars[b];if(b===a)break}return this},inc:function(c){return!a.Template.isExists(c)?"":a.Template.get(c).execSync(this)}};a.Compiler=function(c){if(this instanceof a.Compiler)this._closure=this._template=null,this._source="",this._stack=[],this._includes=[],this._line=1,this._data={},this._captureName=this.uniqueName("cap_");else{if(!(c instanceof a.Template))throw new a.Exception("[template] must be instance of [smarty.Template]!");
var b=new a.Compiler;b._template=c;b._source=c.getSource();b._compile();c.load(b._closure,b._includes)}};a.Compiler.prototype={constructor:a.Compiler,getLine:function(){return this._line},getTemplate:function(){return this._template},_compile:function(){var c=[];this._source.replace(/\r/g,"").replace(/{\*[\d\D]*?\*}/g,function(a){return"{@comment "+(a.split("\n").length-1)+"}"}.bind(this)).split("\n").forEach(function(a){a=this._compileString(a);c.push(a);this._line++},this);for(var b=null;0<this._stack.length;)if(b=
this._stack.pop(),b.entity.end)throw new a.CompileException(this,"Open tag '{0}' at line {1} doesn't have close tag!",b.name,b.line);b=a.utils.format("try{\t\t\t\tvar {0} = [];\t\t\t\t{1}\t\t\t\treturn {0}.join('');\t\t\t} catch( ex ){\t\t\t\tthrow new smarty.RuntimeException(ex.message);\t\t\t}",this._captureName,c.join("\n"));this._closure=Function(b);a.debug.group("Compiled source: "+this.getTemplate().getName(),!0).log(this._closure.toString()).groupEnd()},uniqueName:function(a){for(var b=6,a=
a||"var_",d;0<b--;)d=Math.floor(62*Math.random()),a+="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz".substring(d,d+1);return a},_compileString:function(c){var b,d=[],e=function(c){return a.utils.format("{0}.push('{1}');",this._captureName,c.replace(/'/g,"\\'"))}.bind(this),g=function(c,b){var f=new a.Expression(b),d=f.getAttributes(),e;for(e in c.attributes)if("_required"===e)c.attributes[e].forEach(function(c){if(!(c in d))throw new a.CompileException(this,"Required attribute '{0}' not exists!",
c);}.bind(this));else if(d[e]){var g=c.attributes[e];if(!a.utils.isArray(g))throw new a.CompileException(this,"Invalid attribute's meta definition!");var h=!1;g.forEach(function(a){d[e]instanceof a&&(h=!0)});if(!h)throw new a.CompileException(this,"Invalid attribute type '{0}'!",e);}return f}.bind(this);for(;null!==(b=/{([$\/@])?([\w][\w\d]*)([^}]*)}/.exec(c));){var i=b[0],h=b[1],j=b[2];b=b[3].trim();var c=c.split(i),k=c.shift();""!==k&&d.push(e(k));c=c.join(i);if("$"===h)b="variable="+h+j+b,j="var";
else if("@"===h&&"comment"===j)return this._line+=parseInt(b),"";if(i=a.entities[j])if("/"===h)if(i.end){for(h=!1;b=this._stack.pop();)if(b.entity.end&&b.name===j){h=!0;break}if(!h)throw new a.CompileException(this,"Unexpected close tag '{0}'!",j);d.push(i.end.call(this,b.expression))}else throw new a.CompileException(this,"Tag '{0}' hasn't need close tag!",j);else{if(i.depends.length){h=!1;for(k=this._stack.length;!h&&0<k;)0<=i.depends.indexOf(this._stack[--k].name)&&(h=!0);if(!h)throw new a.CompileException(this,
"Tag '{0}' must be specified within the following tags: '{1}'!",j,i.depends);}h=g(i,b);this._stack.push({name:j,body:b,expression:h,entity:i,line:this._line});d.push(i.start.call(this,h))}else throw new a.CompileException(this,"Undefined entity '{0}'!",j);}""!==c&&d.push(e(c));return d.join("")}};a.Expression=function(a){this._origin=a||"";this._pos=-1;this._look=0;this._result="";this._attributes={};this._parse()};a.Expression.prototype={constructor:a.Expression,states:{TEXT:256,VAR:257,MODIFIER:258},
toString:function(){return this.getResult()},getOrigin:function(){return this._origin},getResult:function(){return this._result},getPosition:function(){return this._pos},getAttributes:function(){return this._attributes},_next:function(a){this._look=0;return this._origin.charAt(a?this._pos+=a:++this._pos)||!1},_prev:function(a){this._look=0;return this._origin.charAt(a?this._pos-=a:--this._pos)||!1},_rewind:function(a){this._pos=a||-1},_lookForward:function(){return this._origin.charAt(this._pos+ ++this._look)},
_lookBackward:function(){return this._origin.charAt(this._pos+--this._look)},_countChar:function(a,b){for(var d=0;(b?this._lookForward():this._lookBackward())===(a||"\\");)d++;return d},_caseVar:function(c){var b,d,e=0,g,i=0,h="",j={keys:[],modifiers:{}};a:for(;b=this._next();){switch(!0){case /\s|\)/.test(b)&&!e:this._prev();break a;case /\$/.test(b):d=this.states.VAR;break;case /\./.test(b):if(1===d)continue;d=2;break;case /\[/.test(b):i++;d=1;break;case /]/.test(b):--i;if(0>i){this._prev();break a}d=
1;break;case /['"]/.test(b):e&1&&g===b?this._countChar()&1||e--:(e++,g=b);continue;case "|"===b:d=this.states.MODIFIER;break;default:d=this.states.TEXT}if(e)d=this.states.TEXT;switch(d){case 2:case 1:h.length&&j.keys.push(h)&&(h="");break;case this.states.VAR:j.keys.push(this._caseVar(!0));break;case this.states.MODIFIER:b=this._caseModifier();a.utils.extend(j.modifiers,b);break;default:h+=b}}h.length&&j.keys.push(h);if(c)return j;this._result+=a.utils.format("this.gv({0})",JSON.stringify(j))},_caseModifier:function(){var c,
b=0,d,e=1,g="",i=null,h=[];a:for(;c=this._next();){switch(!0){case /\s|\)|\|/.test(c)&&!b:this._prev();break a;case /['"]/.test(c):b&1&&d===c?this._countChar()&1||b--:(b++,d=c);continue;case /:/.test(c):e=2;break;case 1===e&&/[^\w]/.test(c):throw new a.Exception("Invalid modifier name!");case 2===e:e=3}b&&(e=3);switch(e){case 1:g+=c;break;case 2:null!==i&&h.push(i);i="";break;case 3:i+=c}}null!==i&&h.push(i);if(!(g in a.modifiers))throw new a.Exception("Undefined modifier '{0}'!",g);c={};c[g]=h;return c},
_caseAttribute:function(){var c,b=1,d="",e="",g=0,i;this._prev();var h=this.getPosition();a:for(;c=this._next();){switch(!0){case /\s|\)/.test(c)&&!g:this._prev();break a;case /['"]/.test(c):g&1&&i===c?this._countChar()&1||g--:(g++,i=c);break;case "="===c:b=2;continue;case 1===b&&/[^\w]/.test(c):break a;case 2!==b&&/\s/.test(c):break a}g&&(b=2);switch(b){case 1:d+=c;break;case 2:e+=c}}!d.length||!e.length?this._rewind(h):this._attributes[d]=a.AttrTypeFactory(e)},_parse:function(){for(var a,b=0,d,
e;a=this._next();){var g=this._lookBackward();switch(!0){case /['"]/.test(a):b&1&&d===a?this._countChar()&1||b--:(b++,d=a);break;case /\$/.test(a):e=1;break;case /\w/.test(a)&&(""===g||/\s/.test(g))&&2!==e:e=2;break;default:e=this.states.TEXT}if(b)e=this.states.TEXT;switch(e){case 1:this._caseVar();break;case 2:this._caseAttribute();break;default:this._result+=a}}}};a.AttrTypeFactory=function(c){var b,d={Number:/^(-?\d*\.?\d+)$/,Boolean:/^(true|false)$/,Variable:/^\$\w.*$/,String:/^.*$/},e;for(e in d)if(d[e].test(c)){b=
new a[e](c);break}return b};a.Number=function(a){this.value=+a};a.Boolean=function(a){this.value="true"===a?!0:!1};a.String=function(a){this.value=""+a.replace(/^['"]|['"]$/g,"")};a.Variable=function(b){this.value=new a.Expression(b)};a.Number.prototype={constructor:a.Number,toString:function(){return this.value}};a.Boolean.prototype={constructor:a.Boolean,toString:function(){return this.value}};a.String.prototype={constructor:a.String,toString:function(){return"'"+this.value+"'"}};a.Variable.prototype=
{constructor:a.Variable,toString:function(){return this.value.toString()}};"Boolean,Number,String,Function,Array,Date,RegExp,Object".split(",").forEach(function(b){a.utils.types["[object "+b+"]"]=b.toLowerCase()});[a.Template].forEach(function(b){b.inherit=function(b,c){var e=a.utils.inherit(this,b,c);e.inherit=this.inherit;return e}})}})(window);
(function(l){var a=l.smarty;a.addEntity("var",{attributes:{_required:["variable"],variable:[a.Variable]},start:function(b){b=b.getAttributes();return a.utils.format("{0}.push({1});",this._captureName,b.variable)}});a.addEntity("if",{start:function(b){return a.utils.format("/* IF */ if({0}){",b)},end:function(){return"} /* ENDIF */"}});a.addEntity("else",{start:function(){return"} /* ELSE */ else{"},after:["elseif"],depends:["if"]});a.addEntity("elseif",{start:function(b){return a.utils.format("} /* ELSEIF */ else if({0}){",
b)},depends:["if"]});a.addEntity("break",{start:function(){return"/* BREAK */ break;"},depends:["foreach","while"]});a.addEntity("continue",{start:function(){return"/* CONTINUE */ continue;"},depends:["foreach","while"]});a.addEntity("foreach",{attributes:{_required:["from","item"],from:[a.Variable],item:[a.String],key:[a.String],name:[a.String]},start:function(b){b=b.getAttributes();this._data.foreachMeta=this.uniqueName();var c=this.uniqueName(),f=this.uniqueName(),d=this.uniqueName("ns_"),d=a.utils.format("/* FOREACH */\t\t\tvar {0} = {1}, {2} = { key: null, iteration: 0 };\t\t\tthis.sn('{3}');",
c,b.from,this._data.foreachMeta,d);b.name&&(d+=a.utils.format("this.sv({0}, {1});",b.name,this._data.foreachMeta));d+=a.utils.format("\t\t\tif( smarty.utils.isObject({1}) || smarty.utils.isArray({1}) )\t\t\t\tfor(var {0} in {1}){\t\t\t\t\tif(!{1}.hasOwnProperty({0})) continue;\t\t\t\t\t{2}.iteration++, smarty.utils.extend({2}, {\t\t\t\t\t\tkey: {0}\t\t\t\t\t});\t\t\t\t\tthis.sv({3}, {1}[{0}]);",f,c,this._data.foreachMeta,b.item);b.key&&(d+=a.utils.format("this.sv({0}, {1});",b.key,f));return d},end:function(){return"}this.en(); /* ENDFOREACH */"}});
a.addEntity("foreachelse",{start:function(){return a.utils.format("} /* FOREACHELSE */ if({0}.iteration === 0){",this._data.foreachMeta)},depends:["foreach"]});a.addEntity("for",{attributes:{_required:["from","to"],from:[a.Variable,a.Number],to:[a.Variable,a.Number],step:[a.Variable,a.Number],name:[a.String]},start:function(b){var b=b.getAttributes(),c=this.uniqueName(),f=this.uniqueName("ns_"),d=this.uniqueName(),e=this.uniqueName(),f=a.utils.format("/* FOR */\t\t\tvar {0} = { index: 0, iteration: 0 };\t\t\tthis.sn('{1}');",
c,f);b.name&&(f+=a.utils.format("this.sv({0}, {1});",b.name,c));return f+=a.utils.format("for(var {0} = {1}, {2} = {3}; {0} <= {2}; {0} += {4}){\t\t\t{5}.iteration++, smarty.utils.extend({5}, { index: {0} });",d,b.from,e,b.to,b.step||1,c)},end:function(){return"}this.en(); /* ENDFOR */"}});a.addEntity("while",{start:function(b){return a.utils.format("/* WHILE */ while({0}){",b)},end:function(){return"} /* ENDWHILE */"}});a.addEntity("capture",{attributes:{_required:["assign"],assign:[a.String]},start:function(){this._data.captureName=
this.uniqueName("cap_");this._data.oldCaptureName=this._captureName;this._captureName=this._data.captureName;return a.utils.format("/* CAPTURE */ var {0} = [];",this._data.captureName)},end:function(b){b=b.getAttributes();this._captureName=this._data.oldCaptureName;return a.utils.format("this.sv({0}, {1}); /* ENDCAPTURE */",b.assign,this._data.captureName)}});a.addEntity("include",{attributes:{_required:["file"],file:[a.String,a.Variable],assign:[a.String]},start:function(b){b=b.getAttributes();this._includes.push(b.file.value);
var c=a.utils.format("/* INCLUDE */ this.sn({0});",b.file),f;for(f in b)b.hasOwnProperty(f)&&!(f in a.entities.include.attributes)&&(c+=a.utils.format("this.sv('{0}', {1});",f,b[f]));c=b.assign?c+a.utils.format("this.sv({0}, this.inc({1}));",b.assign,b.file):c+a.utils.format("{0}.push(this.inc({1}));",this._captureName,b.file);return c+a.utils.format("this.en({0}); /* ENDINCLUDE */",b.file)}});a.addEntity("dump",{start:function(b){return a.utils.format("console.log({0});",b)}});a.addEntity("html_options",
{attributes:{_required:["options"],options:[a.Variable],selected:[a.String,a.Variable]},start:function(){return""}});a.addEntity("html_radios",{attributes:{_required:["options"],options:[a.Variable],selected:[a.String,a.Variable],separator:[a.String,a.Variable],name:[a.String]},start:function(){return""}});a.addEntity("assign",{attributes:{_required:["var","value"],"var":[a.String],value:[a.String,a.Variable,a.Number,a.Boolean]},start:function(b){b=b.getAttributes();return a.utils.format("/* ASSIGN */ this.sv({0}, {1}); /* ENDASSIGN */",
b["var"],b.value)}});a.addModifier("default",function(b,c){return a.modifiers.empty(b)?c:b});a.addModifier("length",function(b){return a.utils.isString(b)?b.length:a.utils.count(b)});a.addModifier("substr",function(b,c,f){return!a.utils.isString(b)?"":b.substr(c,f)});a.addModifier("upper",function(b){return!a.utils.isString(b)?"":b.toUpperCase()});a.addModifier("lower",function(b){return!a.utils.isString(b)?"":b.toLowerCase()});a.addModifier("cat",function(b,c){return!a.utils.isString(b)?"":b+(c||
"")});a.addModifier("nl2br",function(b){return!a.utils.isString(b)?"":b.replace(/\n/,"<br />")});a.addModifier("date_format",function(a){return a});a.addModifier("truncate",function(a,c,f){return a.substr(0,c)+(f||"")});a.addModifier("split",function(b,c,f){return!a.utils.isString(b)?[]:b.split(c,f)});a.addModifier("join",function(b,c){return!a.utils.isArray(b)?"":b.join(c)});a.addModifier("isset",function(b){return a.utils.isUndefined(b)||null===b?!1:!0});a.addModifier("empty",function(b){return!b?
!0:a.utils.isArray(b)||a.utils.isObject(b)?0===a.utils.count(b):!1});l.smarty.addModifier("escape",function(a,c){switch(""+c){case "html":var f=document.createElement("div"),d=document.createTextNode(a);f.appendChild(d);a=f.innerHTML;break;case "url":a=encodeURI(a);break;case "urlpathinfo":a=encodeURI(a).replace("%2F","/");break;case "quotes":a=a.replace(/(['"])/g,"\\$1")}return a})})(window);
